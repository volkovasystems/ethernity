"use strict";

/*;
	@module-license:
		The MIT License (MIT)
		@mit-license

		Copyright (@c) 2016 Richeve Siodina Bebedor
		@email: richeve.bebedor@gmail.com

		Permission is hereby granted, free of charge, to any person obtaining a copy
		of this software and associated documentation files (the "Software"), to deal
		in the Software without restriction, including without limitation the rights
		to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
		copies of the Software, and to permit persons to whom the Software is
		furnished to do so, subject to the following conditions:

		The above copyright notice and this permission notice shall be included in all
		copies or substantial portions of the Software.

		THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
		IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
		FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
		AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
		LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
		OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
		SOFTWARE.
	@end-module-license

	@module-configuration:
		{
			"package": "ethernity",
			"path": "ethernity/ethernity.js",
			"file": "ethernity.js",
			"module": "ethernity",
			"author": "Richeve S. Bebedor",
			"contributors": [
				"John Lenon Maghanoy <johnlenonmaghanoy@gmail.com>"
			],
			"eMail": "richeve.bebedor@gmail.com",
			"repository": "https://github.com:volkovasystems/ethernity.git",
			"test": "ethernity-test.js",
			"global": true,
			"class": true,
		}
	@end-module-configuration

	@module-documentation:
		Persist time as true time.

		This will discard milliseconds value.
	@end-module-documentation

	@include:
		{
			"asea": "asea",
			"diatom": "diatom",
			"doubt": "doubt",
			"falzy": "falzy",
			"harden": "harden",
			"moment": "moment",
			"optfor": "optfor",
			"truu": "truu",
			"U200b": "u200b"
		}
	@end-include
*/

var asea = require("asea");
var clazof = require("clazof");
var diatom = require("diatom");
var doubt = require("doubt");
var falzy = require("falzy");
var harden = require("harden");
var moment = require("moment");
var optfor = require("optfor");
var protype = require("protype");
var truly = require("truly");
var U200b = require("u200b");

var Ethernity = diatom("Ethernity");

harden("now", function now() {
	return Ethernity().compact();
}, Ethernity);

Ethernity.prototype.toString = function toString() {
	return this.trueTime;
};

Ethernity.prototype.valueOf = function valueOf() {
	return this.trueTime;
};

Ethernity.prototype.initialize = function initialize(date) {
	/*;
 	@meta-configuration:
 		{
 			"date:required": [
 				[ "number", "number" ],
 				"string",
 				Date
 			]
 		}
 	@end-meta-configuration
 */

	if (doubt(date).ARRAY && protype(date[0], NUMBER) && protype(date[1], NUMBER) && date[0].toString().length == 17) {
		this.offset = date[1];

		this.date = moment.utc(date[0], Ethernity.COMPACT_FORMAT).millisecond(0).utcOffset(this.offset);

		this.persist();
	} else if (protype(date, STRING) && date.length == 27 && Ethernity.TRUE_TIME_PATTERN.test(date)) {
		this.date = date;

		this.parse();
	} else if (truly(date) && protype(date, STRING)) {
		try {
			date = moment(date);

			if (date.isValid()) {
				this.initialize(date.toDate());
			} else {
				throw new Error("invalid format, " + arguments[0]);
			}
		} catch (error) {
			throw new Error("error encountered while parsing, " + error.message);
		}
	} else if (clazof(date, Date)) {
		this.date = moment(date);

		this.persist();
	} else {
		this.date = moment(new Date());

		this.persist();
	}

	return this;
};

/*
	@method-documentation:
		This should be persisted on the machine where the timezone is persisted.

		It will save the true time in utc format + the machine timezone.
	@end-method-documentation
*/
Ethernity.prototype.persist = function persist() {
	if (truly(this.trueTime)) {
		return this.trueTime;
	}

	var date = this.date.toDate();

	var offset = this.offset || this.date.utcOffset();
	try {
		offset = parseInt(offset);
	} catch (error) {
		throw new Error("invalid timezone offset, " + error.message);
	}

	var polarity = offset / Math.abs(offset);

	var trueTime = U200b([polarity.toString().replace(Ethernity.NUMERIC_PATTERN, "") || "0", date.getUTCFullYear(), ("0" + (date.getUTCMonth() + 1)).slice(-2), ("0" + date.getUTCDate()).slice(-2), ("0" + date.getUTCHours()).slice(-2), ("0" + date.getUTCMinutes()).slice(-2), ("0" + date.getUTCSeconds()).slice(-2), ("000" + Math.abs(offset)).slice(-5)]).join();

	this.trueTime = trueTime;

	this.offset = offset;

	return trueTime;
};

/*;
	@method-documentation:
		Decompose true time to a moment object.
	@end-method-documentation
*/
Ethernity.prototype.parse = function parse() {
	var date = this.date;
	if (protype(this.date, STRING)) {
		date = U200b(this.date).separate();
	} else if (truly(this.trueTime)) {
		date = U200b(this.trueTime).separate();
	} else {
		throw new Error("date not specified");
	}

	try {
		var polarity = parseInt(date[0] + 1);

		this.offset = polarity * parseInt(date[7]);

		date = moment.utc().year(parseInt(date[1])).month(parseInt(date[2]) - 1).date(parseInt(date[3])).hour(parseInt(date[4])).minute(parseInt(date[5])).second(parseInt(date[6])).millisecond(0);
	} catch (error) {
		throw new Error("error parsing true time, " + error.message);
	}

	//: This will set the timezone of the Date object to the machine timezone.
	this.date = date;

	this.persist();

	return this;
};

/*;
	@method-documentation:
		Relative time is the time applied with UTC offset.

		This will return the time in ISO8601 format format with milliseconds dropped.
			@code:YYYY-MM-DDTHH:mm.ss;

		Do not use this to reference true time.
	@end-method-documentation
*/
Ethernity.prototype.relativeTime = function relativeTime() {
	if (falzy(this.date)) {
		throw new Error("internal date empty");
	}

	if (falzy(this.offset)) {
		throw new Error("internal timezone offset empty");
	}

	return this.date.utc().utcOffset(this.offset).format(Ethernity.ISO8601_FORMAT);
};

/*;
	@method-documentation:
		Real time is the time with no UTC offset applied.

		This will return the time in ISO8601 format with milliseconds dropped.
			@code:YYYY-MM-DDTHH:mm.ss;
	@end-method-documentation
*/
Ethernity.prototype.realTime = function realTime() {
	if (falzy(this.date)) {
		throw new Error("internal date empty");
	}

	return this.date.utc().format(Ethernity.ISO8601_FORMAT);
};

/*;
	@method-documentation:
		Returns a simple human readable representation of time in 12 hour format.

		Time will be relative.
	@end-method-documentation
*/
Ethernity.prototype.getTime = function getTime() {
	if (falzy(this.date)) {
		throw new Error("internal date empty");
	}

	if (falzy(this.offset)) {
		throw new Error("internal timezone offset empty");
	}

	return this.date.utc().utcOffset(this.offset).format(Ethernity.SIMPLE_TIME_FORMAT);
};

/*;
	@method-documentation:
		Returns a simple human readable representation of date.

		Date will be relative.
	@end-method-documentation
*/
Ethernity.prototype.getDate = function getDate() {
	if (falzy(this.date)) {
		throw new Error("internal date empty");
	}

	if (falzy(this.offset)) {
		throw new Error("internal timezone offset empty");
	}

	return this.date.utc().utcOffset(this.offset).format(Ethernity.SIMPLE_DATE_FORMAT);
};

/*;
	@method-documentation:
		Returns a simple human readable representation of time and date.

		Time and date will be relative.

		Setting complete will append true time format.
	@end-method-documentation
*/
Ethernity.prototype.printTime = function printTime(separator, complete) {
	/*;
 	@meta-configuration:
 		{
 			"separator": "string",
 			"complete": "boolean"
 		}
 	@end-meta-configuration
 */

	separator = optfor(arguments, STRING);

	separator = separator || Ethernity.DEFAULT_SEPARATOR;
	if (!protype(separator, STRING)) {
		separator = Ethernity.DEFAULT_SEPARATOR;
	}

	complete = optfor(arguments, BOOLEAN);

	if (complete === true) {
		return [this.getDate(), this.getTime(), this.trueTime].join(separator);
	} else {
		return [this.getDate(), this.getTime()].join(separator);
	}
};

/*;
	@method-documentation:
		Returns a numerical representation of true time.
	@end-method-documentation
*/
Ethernity.prototype.compact = function compact() {
	var date = this.date.utc().format(Ethernity.COMPACT_FORMAT);

	return [date, this.offset].map(function onEachToken(token) {
		return parseInt(token.toString());
	});
};

harden.bind(Ethernity)("DEFAULT_SEPARATOR", " | ");

harden.bind(Ethernity)("COMPACT_FORMAT", "YYYYMMDDHHmmss");

harden.bind(Ethernity)("ISO8601_FORMAT", "YYYY-MM-DDTHH:mm:ss");

harden.bind(Ethernity)("SIMPLE_DATE_FORMAT", "MMMM DD, YYYY");

harden.bind(Ethernity)("SIMPLE_TIME_FORMAT", "hh:mm:ss A");

harden.bind(Ethernity)("TRUE_TIME_PATTERN", /^\-[\d\u200b]{26}|^[\d\u200b]{27}$/);

harden.bind(Ethernity)("NUMERIC_PATTERN", /\d+/);

module.exports = Ethernity;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV0aGVybml0eS5qcyJdLCJuYW1lcyI6WyJhc2VhIiwicmVxdWlyZSIsImNsYXpvZiIsImRpYXRvbSIsImRvdWJ0IiwiZmFsenkiLCJoYXJkZW4iLCJtb21lbnQiLCJvcHRmb3IiLCJwcm90eXBlIiwidHJ1bHkiLCJVMjAwYiIsIkV0aGVybml0eSIsIm5vdyIsImNvbXBhY3QiLCJwcm90b3R5cGUiLCJ0b1N0cmluZyIsInRydWVUaW1lIiwidmFsdWVPZiIsImluaXRpYWxpemUiLCJkYXRlIiwiQVJSQVkiLCJOVU1CRVIiLCJsZW5ndGgiLCJvZmZzZXQiLCJ1dGMiLCJDT01QQUNUX0ZPUk1BVCIsIm1pbGxpc2Vjb25kIiwidXRjT2Zmc2V0IiwicGVyc2lzdCIsIlNUUklORyIsIlRSVUVfVElNRV9QQVRURVJOIiwidGVzdCIsInBhcnNlIiwiaXNWYWxpZCIsInRvRGF0ZSIsIkVycm9yIiwiYXJndW1lbnRzIiwiZXJyb3IiLCJtZXNzYWdlIiwiRGF0ZSIsInBhcnNlSW50IiwicG9sYXJpdHkiLCJNYXRoIiwiYWJzIiwicmVwbGFjZSIsIk5VTUVSSUNfUEFUVEVSTiIsImdldFVUQ0Z1bGxZZWFyIiwiZ2V0VVRDTW9udGgiLCJzbGljZSIsImdldFVUQ0RhdGUiLCJnZXRVVENIb3VycyIsImdldFVUQ01pbnV0ZXMiLCJnZXRVVENTZWNvbmRzIiwiam9pbiIsInNlcGFyYXRlIiwieWVhciIsIm1vbnRoIiwiaG91ciIsIm1pbnV0ZSIsInNlY29uZCIsInJlbGF0aXZlVGltZSIsImZvcm1hdCIsIklTTzg2MDFfRk9STUFUIiwicmVhbFRpbWUiLCJnZXRUaW1lIiwiU0lNUExFX1RJTUVfRk9STUFUIiwiZ2V0RGF0ZSIsIlNJTVBMRV9EQVRFX0ZPUk1BVCIsInByaW50VGltZSIsInNlcGFyYXRvciIsImNvbXBsZXRlIiwiREVGQVVMVF9TRVBBUkFUT1IiLCJCT09MRUFOIiwibWFwIiwib25FYWNoVG9rZW4iLCJ0b2tlbiIsImJpbmQiLCJtb2R1bGUiLCJleHBvcnRzIl0s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QUFiLEVBQTBCLGdCQUExQixFQUE0QyxxQkFBNUM7O0FBRUFOLE9BQU91RSxJQUFQLENBQWFqRSxTQUFiLEVBQTBCLG9CQUExQixFQUFnRCxlQUFoRDs7QUFFQU4sT0FBT3VFLElBQVAsQ0FBYWpFLFNBQWIsRUFBMEIsb0JBQTFCLEVBQWdELFlBQWhEOztBQUVBTixPQUFPdUUsSUFBUCxDQUFhakUsU0FBYixFQUEwQixtQkFBMUIsRUFBK0Msb0NBQS9DOztBQUVBTixPQUFPdUUsSUFBUCxDQUFhakUsU0FBYixFQUEwQixpQkFBMUIsRUFBNkMsS0FBN0M7O0FBRUFrRSxPQUFPQyxPQUFQLEdBQWlCbkUsU0FBakIiLCJmaWxlIjoiZXRoZXJuaXR5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qO1xuXHRAbW9kdWxlLWxpY2Vuc2U6XG5cdFx0VGhlIE1JVCBMaWNlbnNlIChNSVQpXG5cdFx0QG1pdC1saWNlbnNlXG5cblx0XHRDb3B5cmlnaHQgKEBjKSAyMDE2IFJpY2hldmUgU2lvZGluYSBCZWJlZG9yXG5cdFx0QGVtYWlsOiByaWNoZXZlLmJlYmVkb3JAZ21haWwuY29tXG5cblx0XHRQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5cdFx0b2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuXHRcdGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcblx0XHR0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5cdFx0Y29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5cdFx0ZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuXHRcdFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuXHRcdGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblx0XHRUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5cdFx0SU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5cdFx0RklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5cdFx0QVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuXHRcdExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5cdFx0T1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblx0XHRTT0ZUV0FSRS5cblx0QGVuZC1tb2R1bGUtbGljZW5zZVxuXG5cdEBtb2R1bGUtY29uZmlndXJhdGlvbjpcblx0XHR7XG5cdFx0XHRcInBhY2thZ2VcIjogXCJldGhlcm5pdHlcIixcblx0XHRcdFwicGF0aFwiOiBcImV0aGVybml0eS9ldGhlcm5pdHkuanNcIixcblx0XHRcdFwiZmlsZVwiOiBcImV0aGVybml0eS5qc1wiLFxuXHRcdFx0XCJtb2R1bGVcIjogXCJldGhlcm5pdHlcIixcblx0XHRcdFwiYXV0aG9yXCI6IFwiUmljaGV2ZSBTLiBCZWJlZG9yXCIsXG5cdFx0XHRcImNvbnRyaWJ1dG9yc1wiOiBbXG5cdFx0XHRcdFwiSm9obiBMZW5vbiBNYWdoYW5veSA8am9obmxlbm9ubWFnaGFub3lAZ21haWwuY29tPlwiXG5cdFx0XHRdLFxuXHRcdFx0XCJlTWFpbFwiOiBcInJpY2hldmUuYmViZWRvckBnbWFpbC5jb21cIixcblx0XHRcdFwicmVwb3NpdG9yeVwiOiBcImh0dHBzOi8vZ2l0aHViLmNvbTp2b2xrb3Zhc3lzdGVtcy9ldGhlcm5pdHkuZ2l0XCIsXG5cdFx0XHRcInRlc3RcIjogXCJldGhlcm5pdHktdGVzdC5qc1wiLFxuXHRcdFx0XCJnbG9iYWxcIjogdHJ1ZSxcblx0XHRcdFwiY2xhc3NcIjogdHJ1ZSxcblx0XHR9XG5cdEBlbmQtbW9kdWxlLWNvbmZpZ3VyYXRpb25cblxuXHRAbW9kdWxlLWRvY3VtZW50YXRpb246XG5cdFx0UGVyc2lzdCB0aW1lIGFzIHRydWUgdGltZS5cblxuXHRcdFRoaXMgd2lsbCBkaXNjYXJkIG1pbGxpc2Vjb25kcyB2YWx1ZS5cblx0QGVuZC1tb2R1bGUtZG9jdW1lbnRhdGlvblxuXG5cdEBpbmNsdWRlOlxuXHRcdHtcblx0XHRcdFwiYXNlYVwiOiBcImFzZWFcIixcblx0XHRcdFwiZGlhdG9tXCI6IFwiZGlhdG9tXCIsXG5cdFx0XHRcImRvdWJ0XCI6IFwiZG91YnRcIixcblx0XHRcdFwiZmFsenlcIjogXCJmYWx6eVwiLFxuXHRcdFx0XCJoYXJkZW5cIjogXCJoYXJkZW5cIixcblx0XHRcdFwibW9tZW50XCI6IFwibW9tZW50XCIsXG5cdFx0XHRcIm9wdGZvclwiOiBcIm9wdGZvclwiLFxuXHRcdFx0XCJ0cnV1XCI6IFwidHJ1dVwiLFxuXHRcdFx0XCJVMjAwYlwiOiBcInUyMDBiXCJcblx0XHR9XG5cdEBlbmQtaW5jbHVkZVxuKi9cblxuY29uc3QgYXNlYSA9IHJlcXVpcmUoIFwiYXNlYVwiICk7XG5jb25zdCBjbGF6b2YgPSByZXF1aXJlKCBcImNsYXpvZlwiICk7XG5jb25zdCBkaWF0b20gPSByZXF1aXJlKCBcImRpYXRvbVwiICk7XG5jb25zdCBkb3VidCA9IHJlcXVpcmUoIFwiZG91YnRcIiApO1xuY29uc3QgZmFsenkgPSByZXF1aXJlKCBcImZhbHp5XCIgKTtcbmNvbnN0IGhhcmRlbiA9IHJlcXVpcmUoIFwiaGFyZGVuXCIgKTtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoIFwibW9tZW50XCIgKTtcbmNvbnN0IG9wdGZvciA9IHJlcXVpcmUoIFwib3B0Zm9yXCIgKTtcbmNvbnN0IHByb3R5cGUgPSByZXF1aXJlKCBcInByb3R5cGVcIiApO1xuY29uc3QgdHJ1bHkgPSByZXF1aXJlKCBcInRydWx5XCIgKTtcbmNvbnN0IFUyMDBiID0gcmVxdWlyZSggXCJ1MjAwYlwiICk7XG5cbmNvbnN0IEV0aGVybml0eSA9IGRpYXRvbSggXCJFdGhlcm5pdHlcIiApO1xuXG5oYXJkZW4oIFwibm93XCIsIGZ1bmN0aW9uIG5vdyggKXtcblx0cmV0dXJuIEV0aGVybml0eSggKS5jb21wYWN0KCApO1xufSwgRXRoZXJuaXR5ICk7XG5cbkV0aGVybml0eS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZyggKXtcblx0cmV0dXJuIHRoaXMudHJ1ZVRpbWU7XG59O1xuXG5FdGhlcm5pdHkucHJvdG90eXBlLnZhbHVlT2YgPSBmdW5jdGlvbiB2YWx1ZU9mKCApe1xuXHRyZXR1cm4gdGhpcy50cnVlVGltZTtcbn07XG5cbkV0aGVybml0eS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIGluaXRpYWxpemUoIGRhdGUgKXtcblx0Lyo7XG5cdFx0QG1ldGEtY29uZmlndXJhdGlvbjpcblx0XHRcdHtcblx0XHRcdFx0XCJkYXRlOnJlcXVpcmVkXCI6IFtcblx0XHRcdFx0XHRbIFwibnVtYmVyXCIsIFwibnVtYmVyXCIgXSxcblx0XHRcdFx0XHRcInN0cmluZ1wiLFxuXHRcdFx0XHRcdERhdGVcblx0XHRcdFx0XVxuXHRcdFx0fVxuXHRcdEBlbmQtbWV0YS1jb25maWd1cmF0aW9uXG5cdCovXG5cblx0aWYoIGRvdWJ0KCBkYXRlICkuQVJSQVkgJiZcblx0XHRwcm90eXBlKCBkYXRlWyAwIF0sIE5VTUJFUiApICYmXG5cdFx0cHJvdHlwZSggZGF0ZVsgMSBdLCBOVU1CRVIgKSAmJlxuXHRcdGRhdGVbIDAgXS50b1N0cmluZyggKS5sZW5ndGggPT0gMTcgKVxuXHR7XG5cdFx0dGhpcy5vZmZzZXQgPSBkYXRlWyAxIF07XG5cblx0XHR0aGlzLmRhdGUgPSBtb21lbnQudXRjKCBkYXRlWyAwIF0sIEV0aGVybml0eS5DT01QQUNUX0ZPUk1BVCApXG5cdFx0XHQubWlsbGlzZWNvbmQoIDAgKVxuXHRcdFx0LnV0Y09mZnNldCggdGhpcy5vZmZzZXQgKTtcblxuXHRcdHRoaXMucGVyc2lzdCggKTtcblxuXHR9ZWxzZSBpZiggcHJvdHlwZSggZGF0ZSwgU1RSSU5HICkgJiZcblx0XHRkYXRlLmxlbmd0aCA9PSAyNyAmJlxuXHRcdEV0aGVybml0eS5UUlVFX1RJTUVfUEFUVEVSTi50ZXN0KCBkYXRlICkgKVxuXHR7XG5cdFx0dGhpcy5kYXRlID0gZGF0ZTtcblxuXHRcdHRoaXMucGFyc2UoICk7XG5cblx0fWVsc2UgaWYoIHRydWx5KCBkYXRlICkgJiYgcHJvdHlwZSggZGF0ZSwgU1RSSU5HICkgKXtcblx0XHR0cnl7XG5cdFx0XHRkYXRlID0gbW9tZW50KCBkYXRlICk7XG5cblx0XHRcdGlmKCBkYXRlLmlzVmFsaWQoICkgKXtcblx0XHRcdFx0dGhpcy5pbml0aWFsaXplKCBkYXRlLnRvRGF0ZSggKSApO1xuXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCBcImludmFsaWQgZm9ybWF0LCBcIiArIGFyZ3VtZW50c1sgMCBdICk7XG5cdFx0XHR9XG5cblx0XHR9Y2F0Y2goIGVycm9yICl7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoIFwiZXJyb3IgZW5jb3VudGVyZWQgd2hpbGUgcGFyc2luZywgXCIgKyBlcnJvci5tZXNzYWdlICk7XG5cdFx0fVxuXG5cdH1lbHNlIGlmKCBjbGF6b2YoIGRhdGUsIERhdGUgKSApe1xuXHRcdHRoaXMuZGF0ZSA9IG1vbWVudCggZGF0ZSApO1xuXG5cdFx0dGhpcy5wZXJzaXN0KCApO1xuXG5cdH1lbHNle1xuXHRcdHRoaXMuZGF0ZSA9IG1vbWVudCggbmV3IERhdGUoICkgKTtcblxuXHRcdHRoaXMucGVyc2lzdCggKTtcblx0fVxuXG5cdHJldHVybiB0aGlzO1xufTtcblxuLypcblx0QG1ldGhvZC1kb2N1bWVudGF0aW9uOlxuXHRcdFRoaXMgc2hvdWxkIGJlIHBlcnNpc3RlZCBvbiB0aGUgbWFjaGluZSB3aGVyZSB0aGUgdGltZXpvbmUgaXMgcGVyc2lzdGVkLlxuXG5cdFx0SXQgd2lsbCBzYXZlIHRoZSB0cnVlIHRpbWUgaW4gdXRjIGZvcm1hdCArIHRoZSBtYWNoaW5lIHRpbWV6b25lLlxuXHRAZW5kLW1ldGhvZC1kb2N1bWVudGF0aW9uXG4qL1xuRXRoZXJuaXR5LnByb3RvdHlwZS5wZXJzaXN0ID0gZnVuY3Rpb24gcGVyc2lzdCggKXtcblx0aWYoIHRydWx5KCB0aGlzLnRydWVUaW1lICkgKXtcblx0XHRyZXR1cm4gdGhpcy50cnVlVGltZTtcblx0fVxuXG5cdGxldCBkYXRlID0gdGhpcy5kYXRlLnRvRGF0ZSggKTtcblxuXHRsZXQgb2Zmc2V0ID0gdGhpcy5vZmZzZXQgfHwgdGhpcy5kYXRlLnV0Y09mZnNldCggKTtcblx0dHJ5e1xuXHRcdG9mZnNldCA9IHBhcnNlSW50KCBvZmZzZXQgKTtcblxuXHR9Y2F0Y2goIGVycm9yICl7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCBcImludmFsaWQgdGltZXpvbmUgb2Zmc2V0LCBcIiArIGVycm9yLm1lc3NhZ2UgKTtcblx0fVxuXG5cdGxldCBwb2xhcml0eSA9IG9mZnNldCAvIE1hdGguYWJzKCBvZmZzZXQgKTtcblxuXHRsZXQgdHJ1ZVRpbWUgPSBVMjAwYiggW1xuXHRcdHBvbGFyaXR5LnRvU3RyaW5nKCApLnJlcGxhY2UoIEV0aGVybml0eS5OVU1FUklDX1BBVFRFUk4sIFwiXCIgKSB8fCBcIjBcIixcblxuXHRcdGRhdGUuZ2V0VVRDRnVsbFllYXIoICksXG5cblx0XHQoIFwiMFwiICsgKCBkYXRlLmdldFVUQ01vbnRoKCApICsgMSApICkuc2xpY2UoIC0yICksXG5cdFx0KCBcIjBcIiArICggZGF0ZS5nZXRVVENEYXRlKCApICkgKS5zbGljZSggLTIgKSxcblx0XHQoIFwiMFwiICsgKCBkYXRlLmdldFVUQ0hvdXJzKCApICkgKS5zbGljZSggLTIgKSxcblx0XHQoIFwiMFwiICsgKCBkYXRlLmdldFVUQ01pbnV0ZXMoICkgKSApLnNsaWNlKCAtMiApLFxuXHRcdCggXCIwXCIgKyAoIGRhdGUuZ2V0VVRDU2Vjb25kcyggKSApICkuc2xpY2UoIC0yICksXG5cblx0XHQoIFwiMDAwXCIgKyBNYXRoLmFicyggb2Zmc2V0ICkgKS5zbGljZSggLTUgKVxuXHRdICkuam9pbiggKTtcblxuXHR0aGlzLnRydWVUaW1lID0gdHJ1ZVRpbWU7XG5cblx0dGhpcy5vZmZzZXQgPSBvZmZzZXQ7XG5cblx0cmV0dXJuIHRydWVUaW1lO1xufTtcblxuLyo7XG5cdEBtZXRob2QtZG9jdW1lbnRhdGlvbjpcblx0XHREZWNvbXBvc2UgdHJ1ZSB0aW1lIHRvIGEgbW9tZW50IG9iamVjdC5cblx0QGVuZC1tZXRob2QtZG9jdW1lbnRhdGlvblxuKi9cbkV0aGVybml0eS5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiBwYXJzZSggKXtcblx0bGV0IGRhdGUgPSB0aGlzLmRhdGU7XG5cdGlmKCBwcm90eXBlKCB0aGlzLmRhdGUsIFNUUklORyApICl7XG5cdFx0ZGF0ZSA9IFUyMDBiKCB0aGlzLmRhdGUgKS5zZXBhcmF0ZSggKTtcblxuXHR9ZWxzZSBpZiggdHJ1bHkoIHRoaXMudHJ1ZVRpbWUgKSApe1xuXHRcdGRhdGUgPSBVMjAwYiggdGhpcy50cnVlVGltZSApLnNlcGFyYXRlKCApO1xuXG5cdH1lbHNle1xuXHRcdHRocm93IG5ldyBFcnJvciggXCJkYXRlIG5vdCBzcGVjaWZpZWRcIiApO1xuXHR9XG5cblx0dHJ5e1xuXHRcdGxldCBwb2xhcml0eSA9IHBhcnNlSW50KCBkYXRlWyAwIF0gKyAxICk7XG5cblx0XHR0aGlzLm9mZnNldCA9IHBvbGFyaXR5ICogcGFyc2VJbnQoIGRhdGVbIDcgXSApO1xuXG5cdFx0ZGF0ZSA9IG1vbWVudC51dGMoIClcblx0XHRcdC55ZWFyKCBwYXJzZUludCggZGF0ZVsgMSBdICkgKVxuXHRcdFx0Lm1vbnRoKCBwYXJzZUludCggZGF0ZVsgMiBdICkgLSAxIClcblx0XHRcdC5kYXRlKCBwYXJzZUludCggZGF0ZVsgMyBdICkgKVxuXHRcdFx0LmhvdXIoIHBhcnNlSW50KCBkYXRlWyA0IF0gKSApXG5cdFx0XHQubWludXRlKCBwYXJzZUludCggZGF0ZVsgNSBdICkgKVxuXHRcdFx0LnNlY29uZCggcGFyc2VJbnQoIGRhdGVbIDYgXSApIClcblx0XHRcdC5taWxsaXNlY29uZCggMCApO1xuXG5cdH1jYXRjaCggZXJyb3IgKXtcblx0XHR0aHJvdyBuZXcgRXJyb3IoIFwiZXJyb3IgcGFyc2luZyB0cnVlIHRpbWUsIFwiICsgZXJyb3IubWVzc2FnZSApO1xuXHR9XG5cblx0Ly86IFRoaXMgd2lsbCBzZXQgdGhlIHRpbWV6b25lIG9mIHRoZSBEYXRlIG9iamVjdCB0byB0aGUgbWFjaGluZSB0aW1lem9uZS5cblx0dGhpcy5kYXRlID0gZGF0ZTtcblxuXHR0aGlzLnBlcnNpc3QoICk7XG5cblx0cmV0dXJuIHRoaXM7XG59O1xuXG4vKjtcblx0QG1ldGhvZC1kb2N1bWVudGF0aW9uOlxuXHRcdFJlbGF0aXZlIHRpbWUgaXMgdGhlIHRpbWUgYXBwbGllZCB3aXRoIFVUQyBvZmZzZXQuXG5cblx0XHRUaGlzIHdpbGwgcmV0dXJuIHRoZSB0aW1lIGluIElTTzg2MDEgZm9ybWF0IGZvcm1hdCB3aXRoIG1pbGxpc2Vjb25kcyBkcm9wcGVkLlxuXHRcdFx0QGNvZGU6WVlZWS1NTS1ERFRISDptbS5zcztcblxuXHRcdERvIG5vdCB1c2UgdGhpcyB0byByZWZlcmVuY2UgdHJ1ZSB0aW1lLlxuXHRAZW5kLW1ldGhvZC1kb2N1bWVudGF0aW9uXG4qL1xuRXRoZXJuaXR5LnByb3RvdHlwZS5yZWxhdGl2ZVRpbWUgPSBmdW5jdGlvbiByZWxhdGl2ZVRpbWUoICl7XG5cdGlmKCBmYWx6eSggdGhpcy5kYXRlICkgKXtcblx0XHR0aHJvdyBuZXcgRXJyb3IoIFwiaW50ZXJuYWwgZGF0ZSBlbXB0eVwiICk7XG5cdH1cblxuXHRpZiggZmFsenkoIHRoaXMub2Zmc2V0ICkgKXtcblx0XHR0aHJvdyBuZXcgRXJyb3IoIFwiaW50ZXJuYWwgdGltZXpvbmUgb2Zmc2V0IGVtcHR5XCIgKTtcblx0fVxuXG5cdHJldHVybiB0aGlzLmRhdGUudXRjKCApLnV0Y09mZnNldCggdGhpcy5vZmZzZXQgKS5mb3JtYXQoIEV0aGVybml0eS5JU084NjAxX0ZPUk1BVCApO1xufTtcblxuLyo7XG5cdEBtZXRob2QtZG9jdW1lbnRhdGlvbjpcblx0XHRSZWFsIHRpbWUgaXMgdGhlIHRpbWUgd2l0aCBubyBVVEMgb2Zmc2V0IGFwcGxpZWQuXG5cblx0XHRUaGlzIHdpbGwgcmV0dXJuIHRoZSB0aW1lIGluIElTTzg2MDEgZm9ybWF0IHdpdGggbWlsbGlzZWNvbmRzIGRyb3BwZWQuXG5cdFx0XHRAY29kZTpZWVlZLU1NLUREVEhIOm1tLnNzO1xuXHRAZW5kLW1ldGhvZC1kb2N1bWVudGF0aW9uXG4qL1xuRXRoZXJuaXR5LnByb3RvdHlwZS5yZWFsVGltZSA9IGZ1bmN0aW9uIHJlYWxUaW1lKCApe1xuXHRpZiggZmFsenkoIHRoaXMuZGF0ZSApICl7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCBcImludGVybmFsIGRhdGUgZW1wdHlcIiApO1xuXHR9XG5cblx0cmV0dXJuIHRoaXMuZGF0ZS51dGMoICkuZm9ybWF0KCBFdGhlcm5pdHkuSVNPODYwMV9GT1JNQVQgKTtcbn07XG5cbi8qO1xuXHRAbWV0aG9kLWRvY3VtZW50YXRpb246XG5cdFx0UmV0dXJucyBhIHNpbXBsZSBodW1hbiByZWFkYWJsZSByZXByZXNlbnRhdGlvbiBvZiB0aW1lIGluIDEyIGhvdXIgZm9ybWF0LlxuXG5cdFx0VGltZSB3aWxsIGJlIHJlbGF0aXZlLlxuXHRAZW5kLW1ldGhvZC1kb2N1bWVudGF0aW9uXG4qL1xuRXRoZXJuaXR5LnByb3RvdHlwZS5nZXRUaW1lID0gZnVuY3Rpb24gZ2V0VGltZSggKXtcblx0aWYoIGZhbHp5KCB0aGlzLmRhdGUgKSApe1xuXHRcdHRocm93IG5ldyBFcnJvciggXCJpbnRlcm5hbCBkYXRlIGVtcHR5XCIgKTtcblx0fVxuXG5cdGlmKCBmYWx6eSggdGhpcy5vZmZzZXQgKSApe1xuXHRcdHRocm93IG5ldyBFcnJvciggXCJpbnRlcm5hbCB0aW1lem9uZSBvZmZzZXQgZW1wdHlcIiApO1xuXHR9XG5cblx0cmV0dXJuIHRoaXMuZGF0ZS51dGMoICkudXRjT2Zmc2V0KCB0aGlzLm9mZnNldCApLmZvcm1hdCggRXRoZXJuaXR5LlNJTVBMRV9USU1FX0ZPUk1BVCApO1xufTtcblxuLyo7XG5cdEBtZXRob2QtZG9jdW1lbnRhdGlvbjpcblx0XHRSZXR1cm5zIGEgc2ltcGxlIGh1bWFuIHJlYWRhYmxlIHJlcHJlc2VudGF0aW9uIG9mIGRhdGUuXG5cblx0XHREYXRlIHdpbGwgYmUgcmVsYXRpdmUuXG5cdEBlbmQtbWV0aG9kLWRvY3VtZW50YXRpb25cbiovXG5FdGhlcm5pdHkucHJvdG90eXBlLmdldERhdGUgPSBmdW5jdGlvbiBnZXREYXRlKCApe1xuXHRpZiggZmFsenkoIHRoaXMuZGF0ZSApICl7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCBcImludGVybmFsIGRhdGUgZW1wdHlcIiApO1xuXHR9XG5cblx0aWYoIGZhbHp5KCB0aGlzLm9mZnNldCApICl7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCBcImludGVybmFsIHRpbWV6b25lIG9mZnNldCBlbXB0eVwiICk7XG5cdH1cblxuXHRyZXR1cm4gdGhpcy5kYXRlLnV0YyggKS51dGNPZmZzZXQoIHRoaXMub2Zmc2V0ICkuZm9ybWF0KCBFdGhlcm5pdHkuU0lNUExFX0RBVEVfRk9STUFUICk7XG59O1xuXG4vKjtcblx0QG1ldGhvZC1kb2N1bWVudGF0aW9uOlxuXHRcdFJldHVybnMgYSBzaW1wbGUgaHVtYW4gcmVhZGFibGUgcmVwcmVzZW50YXRpb24gb2YgdGltZSBhbmQgZGF0ZS5cblxuXHRcdFRpbWUgYW5kIGRhdGUgd2lsbCBiZSByZWxhdGl2ZS5cblxuXHRcdFNldHRpbmcgY29tcGxldGUgd2lsbCBhcHBlbmQgdHJ1ZSB0aW1lIGZvcm1hdC5cblx0QGVuZC1tZXRob2QtZG9jdW1lbnRhdGlvblxuKi9cbkV0aGVybml0eS5wcm90b3R5cGUucHJpbnRUaW1lID0gZnVuY3Rpb24gcHJpbnRUaW1lKCBzZXBhcmF0b3IsIGNvbXBsZXRlICl7XG5cdC8qO1xuXHRcdEBtZXRhLWNvbmZpZ3VyYXRpb246XG5cdFx0XHR7XG5cdFx0XHRcdFwic2VwYXJhdG9yXCI6IFwic3RyaW5nXCIsXG5cdFx0XHRcdFwiY29tcGxldGVcIjogXCJib29sZWFuXCJcblx0XHRcdH1cblx0XHRAZW5kLW1ldGEtY29uZmlndXJhdGlvblxuXHQqL1xuXG5cdHNlcGFyYXRvciA9IG9wdGZvciggYXJndW1lbnRzLCBTVFJJTkcgKTtcblxuXHRzZXBhcmF0b3IgPSBzZXBhcmF0b3IgfHwgRXRoZXJuaXR5LkRFRkFVTFRfU0VQQVJBVE9SO1xuXHRpZiggIXByb3R5cGUoIHNlcGFyYXRvciwgU1RSSU5HICkgKXtcblx0XHRzZXBhcmF0b3IgPSBFdGhlcm5pdHkuREVGQVVMVF9TRVBBUkFUT1I7XG5cdH1cblxuXHRjb21wbGV0ZSA9IG9wdGZvciggYXJndW1lbnRzLCBCT09MRUFOICk7XG5cblx0aWYoIGNvbXBsZXRlID09PSB0cnVlICl7XG5cdFx0cmV0dXJuIFsgdGhpcy5nZXREYXRlKCApLCB0aGlzLmdldFRpbWUoICksIHRoaXMudHJ1ZVRpbWUgXS5qb2luKCBzZXBhcmF0b3IgKTtcblxuXHR9ZWxzZXtcblx0XHRyZXR1cm4gWyB0aGlzLmdldERhdGUoICksIHRoaXMuZ2V0VGltZSggKSBdLmpvaW4oIHNlcGFyYXRvciApO1xuXHR9XG59O1xuXG4vKjtcblx0QG1ldGhvZC1kb2N1bWVudGF0aW9uOlxuXHRcdFJldHVybnMgYSBudW1lcmljYWwgcmVwcmVzZW50YXRpb24gb2YgdHJ1ZSB0aW1lLlxuXHRAZW5kLW1ldGhvZC1kb2N1bWVudGF0aW9uXG4qL1xuRXRoZXJuaXR5LnByb3RvdHlwZS5jb21wYWN0ID0gZnVuY3Rpb24gY29tcGFjdCggKXtcblx0bGV0IGRhdGUgPSB0aGlzLmRhdGUudXRjKCApLmZvcm1hdCggRXRoZXJuaXR5LkNPTVBBQ1RfRk9STUFUICk7XG5cblx0cmV0dXJuIFsgZGF0ZSwgdGhpcy5vZmZzZXQgXVxuXHRcdC5tYXAoIGZ1bmN0aW9uIG9uRWFjaFRva2VuKCB0b2tlbiApe1xuXHRcdFx0cmV0dXJuIHBhcnNlSW50KCB0b2tlbi50b1N0cmluZyggKSApO1xuXHRcdH0gKTtcbn07XG5cbmhhcmRlbi5iaW5kKCBFdGhlcm5pdHkgKSggXCJERUZBVUxUX1NFUEFSQVRPUlwiLCBcIiB8IFwiICk7XG5cbmhhcmRlbi5iaW5kKCBFdGhlcm5pdHkgKSggXCJDT01QQUNUX0ZPUk1BVFwiLCBcIllZWVlNTURESEhtbXNzXCIgKTtcblxuaGFyZGVuLmJpbmQoIEV0aGVybml0eSApKCBcIklTTzg2MDFfRk9STUFUXCIsIFwiWVlZWS1NTS1ERFRISDptbTpzc1wiICk7XG5cbmhhcmRlbi5iaW5kKCBFdGhlcm5pdHkgKSggXCJTSU1QTEVfREFURV9GT1JNQVRcIiwgXCJNTU1NIERELCBZWVlZXCIgKTtcblxuaGFyZGVuLmJpbmQoIEV0aGVybml0eSApKCBcIlNJTVBMRV9USU1FX0ZPUk1BVFwiLCBcImhoOm1tOnNzIEFcIiApO1xuXG5oYXJkZW4uYmluZCggRXRoZXJuaXR5ICkoIFwiVFJVRV9USU1FX1BBVFRFUk5cIiwgL15cXC1bXFxkXFx1MjAwYl17MjZ9fF5bXFxkXFx1MjAwYl17Mjd9JC8gKTtcblxuaGFyZGVuLmJpbmQoIEV0aGVybml0eSApKCBcIk5VTUVSSUNfUEFUVEVSTlwiLCAvXFxkKy8gKTtcblxubW9kdWxlLmV4cG9ydHMgPSBFdGhlcm5pdHk7XG4iXX0=
