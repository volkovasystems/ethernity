"use strict";

/*;
	@module-license:
		The MIT License (MIT)
		@mit-license

		Copyright (@c) 2017 Richeve Siodina Bebedor
		@email: richeve.bebedor@gmail.com

		Permission is hereby granted, free of charge, to any person obtaining a copy
		of this software and associated documentation files (the "Software"), to deal
		in the Software without restriction, including without limitation the rights
		to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
		copies of the Software, and to permit persons to whom the Software is
		furnished to do so, subject to the following conditions:

		The above copyright notice and this permission notice shall be included in all
		copies or substantial portions of the Software.

		THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
		IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
		FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
		AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
		LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
		OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
		SOFTWARE.
	@end-module-license

	@module-configuration:
		{
			"package": "ethernity",
			"path": "ethernity/ethernity.js",
			"file": "ethernity.js",
			"module": "ethernity",
			"author": "Richeve S. Bebedor",
			"contributors": [
				"John Lenon Maghanoy <johnlenonmaghanoy@gmail.com>"
			],
			"eMail": "richeve.bebedor@gmail.com",
			"repository": "https://github.com:volkovasystems/ethernity.git",
			"test": "ethernity-test.js",
			"global": true,
			"class": true,
		}
	@end-module-configuration

	@module-documentation:
		Persist time as true time.

		This will discard milliseconds value.
	@end-module-documentation

	@include:
		{
			"clazof": "clazof",
			"depher": "depher",
			"diatom": "diatom",
			"doubt": "doubt",
			"falze": "falze",
			"falzy": "falzy",
			"harden": "harden",
			"moment": "moment",
			"optfor": "optfor",
			"raze": "raze",
			"truly": "truly",
			"U200b": "u200b"
		}
	@end-include
*/

var clazof = require("clazof");
var depher = require("depher");
var diatom = require("diatom");
var doubt = require("doubt");
var falze = require("falze");
var falzy = require("falzy");
var harden = require("harden");
var moment = require("moment");
var optfor = require("optfor");
var protype = require("protype");
var raze = require("raze");
var truly = require("truly");
var U200b = require("u200b");

var COMPACT_FORMAT = "YYYYMMDDHHmmss";
var DEFAULT_SEPARATOR = " | ";
var ISO8601_FORMAT = "YYYY-MM-DDTHH:mm:ss";
var NUMERIC_PATTERN = /\d+/;
var SIMPLE_DATE_FORMAT = "MMMM DD, YYYY";
var SIMPLE_TIME_FORMAT = "hh:mm:ss A";
var TRUE_TIME_PATTERN = /^\-[\d\u200b]{26}|^[\d\u200b]{27}$/;

var Ethernity = diatom("Ethernity");

harden("now", function now() {
	return Ethernity().compact();
}, Ethernity);

Ethernity.prototype.toString = function toString() {
	return this.trueTime;
};

Ethernity.prototype.valueOf = function valueOf() {
	return this.trueTime;
};

Ethernity.prototype.initialize = function initialize(date) {
	/*;
 	@meta-configuration:
 		{
 			"date:required": [
 				[ "number", "number" ],
 				"string",
 				Date
 			]
 		}
 	@end-meta-configuration
 */

	if (doubt(date, ARRAY) && protype(date[0], NUMBER) && protype(date[1], NUMBER) && date[0].toString().length == 17) {
		this.offset = date[1];

		this.date = moment.utc(date[0], COMPACT_FORMAT).millisecond(0).utcOffset(this.offset);

		this.persist();
	} else if (protype(date, STRING) && date.length == 27 && TRUE_TIME_PATTERN.test(date)) {
		this.date = date;

		this.parse();
	} else if (truly(date) && protype(date, STRING)) {
		try {
			date = moment(date);

			if (date.isValid()) {
				this.initialize(date.toDate());
			} else {
				throw new Error("invalid date format, " + arguments[0]);
			}
		} catch (error) {
			throw new Error("error encountered while parsing date, " + error);
		}
	} else if (clazof(date, Date)) {
		this.date = moment(date);

		this.persist();
	} else {
		this.date = moment(new Date());

		this.persist();
	}

	return this;
};

/*
	@method-documentation:
		This should be persisted on the machine where the timezone is persisted.

		It will save the true time in utc format + the machine timezone.
	@end-method-documentation
*/
Ethernity.prototype.persist = function persist() {
	if (truly(this.trueTime)) {
		return this.trueTime;
	}

	var date = this.date.toDate();

	var offset = this.offset || this.date.utcOffset();
	try {
		offset = parseInt(offset);
	} catch (error) {
		throw new Error("invalid timezone offset, " + error);
	}

	var polarity = 0;
	if (offset != 0) {
		polarity = offset / Math.abs(offset);
	}

	var trueTime = U200b([
	//: positive / negative offset
	polarity.toString().replace(NUMERIC_PATTERN, "") || "0",

	//: year
	date.getUTCFullYear(),

	//: month
	("0" + (date.getUTCMonth() + 1)).slice(-2),

	//: day
	("0" + date.getUTCDate()).slice(-2),

	//: hour
	("0" + date.getUTCHours()).slice(-2),

	//: minute
	("0" + date.getUTCMinutes()).slice(-2),

	//: second
	("0" + date.getUTCSeconds()).slice(-2),

	//: offset
	("000" + Math.abs(offset)).slice(-5)]).join();

	this.trueTime = trueTime;

	this.offset = offset;

	return trueTime;
};

/*;
	@method-documentation:
		Decompose true time to a moment object.
	@end-method-documentation
*/
Ethernity.prototype.parse = function parse() {
	var date = this.date;

	if (protype(this.date, STRING)) {
		date = U200b(this.date).separate();
	} else if (truly(this.trueTime)) {
		date = U200b(this.trueTime).separate();
	} else {
		throw new Error("date not specified");
	}

	try {
		var polarity = parseInt(date[0] + 1);

		this.offset = polarity * parseInt(date[7]);

		date = moment.utc().year(parseInt(date[1])).month(parseInt(date[2]) - 1).date(parseInt(date[3])).hour(parseInt(date[4])).minute(parseInt(date[5])).second(parseInt(date[6])).millisecond(0);
	} catch (error) {
		throw new Error("error parsing true time, " + error);
	}

	//: This will set the timezone of the Date object to the machine timezone.
	this.date = date;

	this.persist();

	return this;
};

/*;
	@method-documentation:
		Relative time is the time applied with UTC offset.

		This will return the time in ISO8601 format format with milliseconds dropped.
			@code:YYYY-MM-DDTHH:mm.ss;

		Do not use this to reference true time.
	@end-method-documentation
*/
Ethernity.prototype.relativeTime = function relativeTime() {
	if (falze(this.date)) {
		throw new Error("internal date empty");
	}

	if (falzy(this.offset)) {
		throw new Error("internal timezone offset empty");
	}

	return this.date.utc().utcOffset(this.offset).format(ISO8601_FORMAT);
};

/*;
	@method-documentation:
		Real time is the time with no UTC offset applied.

		This will return the time in ISO8601 format with milliseconds dropped.

		`YYYY-MM-DDTHH:mm.ss`
	@end-method-documentation
*/
Ethernity.prototype.realTime = function realTime() {
	if (falze(this.date)) {
		throw new Error("internal date empty");
	}

	return this.date.utc().format(ISO8601_FORMAT);
};

/*;
	@method-documentation:
		Returns a simple human readable representation of time in 12 hour format.

		Time will be relative.
	@end-method-documentation
*/
Ethernity.prototype.getTime = function getTime() {
	if (falze(this.date)) {
		throw new Error("internal date empty");
	}

	if (falzy(this.offset)) {
		throw new Error("internal timezone offset empty");
	}

	return this.date.utc().utcOffset(this.offset).format(SIMPLE_TIME_FORMAT);
};

/*;
	@method-documentation:
		Returns a simple human readable representation of date.

		Date will be relative.
	@end-method-documentation
*/
Ethernity.prototype.getDate = function getDate() {
	if (falzy(this.date)) {
		throw new Error("internal date empty");
	}

	if (falzy(this.offset)) {
		throw new Error("internal timezone offset empty");
	}

	return this.date.utc().utcOffset(this.offset).format(SIMPLE_DATE_FORMAT);
};

/*;
	@method-documentation:
		Returns a simple human readable representation of time and date.

		Time and date will be relative.

		Setting complete will append true time format.
	@end-method-documentation
*/
Ethernity.prototype.printTime = function printTime(separator, complete) {
	/*;
 	@meta-configuration:
 		{
 			"separator": "string",
 			"complete": "boolean"
 		}
 	@end-meta-configuration
 */

	var parameter = raze(arguments);

	separator = optfor(parameter, STRING);

	separator = separator || DEFAULT_SEPARATOR;
	if (!protype(separator, STRING)) {
		separator = DEFAULT_SEPARATOR;
	}

	complete = depher(arguments, BOOLEAN, false);

	if (complete === true) {
		return [this.getDate(), this.getTime(), this.trueTime].join(separator);
	} else {
		return [this.getDate(), this.getTime()].join(separator);
	}
};

/*;
	@method-documentation:
		Returns a numerical representation of true time.
	@end-method-documentation
*/
Ethernity.prototype.compact = function compact() {
	return [this.date.utc().format(COMPACT_FORMAT), this.offset].map(function onEachToken(token) {
		return parseInt(token.toString());
	});
};

module.exports = Ethernity;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV0aGVybml0eS5qcyJdLCJuYW1lcyI6WyJjbGF6b2YiLCJyZXF1aXJlIiwiZGVwaGVyIiwiZGlhdG9tIiwiZG91YnQiLCJmYWx6ZSIsImZhbHp5IiwiaGFyZGVuIiwibW9tZW50Iiwib3B0Zm9yIiwicHJvdHlwZSIsInJhemUiLCJ0cnVseSIsIlUyMDBiIiwiQ09NUEFDVF9GT1JNQVQiLCJERUZBVUxUX1NFUEFSQVRPUiIsIklTTzg2MDFfRk9STUFUIiwiTlVNRVJJQ19QQVRURVJOIiwiU0lNUExFX0RBVEVfRk9STUFUIiwiU0lNUExFX1RJTUVfRk9STUFUIiwiVFJVRV9USU1FX1BBVFRFUk4iLCJFdGhlcm5pdHkiLCJub3ciLCJjb21wYWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJ0cnVlVGltZSIsInZhbHVlT2YiLCJpbml0aWFsaXplIiwiZGF0ZSIsIkFSUkFZIiwiTlVNQkVSIiwibGVuZ3RoIiwib2Zmc2V0IiwidXRjIiwibWlsbGlzZWNvbmQiLCJ1dGNPZmZzZXQiLCJwZXJzaXN0IiwiU1RSSU5HIiwidGVzdCIsInBhcnNlIiwiaXNWYWxpZCIsInRvRGF0ZSIsIkVycm9yIiwiYXJndW1lbnRzIiwiZXJyb3IiLCJEYXRlIiwicGFyc2VJbnQiLCJwb2xhcml0eSIsIk1hdGgiLCJhYnMiLCJyZXBsYWNlIiwiZ2V0VVRDRnVsbFllYXIiLCJnZXRVVENNb250aCIsInNsaWNlIiwiZ2V0VVRDRGF0ZSIsImdldFVUQ0hvdXJzIiwiZ2V0VVRDTWludXRlcyIsImdldFVUQ1NlY29uZHMiLCJqb2luIiwic2VwYXJhdGUiLCJ5ZWFyIiwibW9udGgiLCJob3VyIiwibWludXRlIiwic2Vjb25kIiwicmVsYXRpdmVUaW1lIiwiZm9ybWF0IiwicmVhbFRpbWUiLCJnZXRUaW1lIiwiZ2V0RGF0ZSIsInByaW50VGltZSIsInNlcGFyYXRvciIsImNvbXBsZXRlIiwicGFyYW1ldGVyIiwiQk9PTEVBTiIsIm1hcCIsIm9uRWFjaFRva2VuIiwidG9rZW4iLCJtb2R1bGUi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QXlCckQsY0FBekIsQ0FBRixFQUE2QyxLQUFLbUIsTUFBbEQsRUFDTDJDLEdBREssQ0FDQSxTQUFTQyxXQUFULENBQXNCQyxLQUF0QixFQUE2QjtBQUFFLFNBQU8vQixTQUFVK0IsTUFBTXJELFFBQU4sRUFBVixDQUFQO0FBQXVDLEVBRHRFLENBQVA7QUFFQSxDQUhEOztBQU9Bc0QsT0FBT0MsT0FBUCxHQUFpQjNELFNBQWpCIiwiZmlsZSI6ImV0aGVybml0eS5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4vKjtcblx0QG1vZHVsZS1saWNlbnNlOlxuXHRcdFRoZSBNSVQgTGljZW5zZSAoTUlUKVxuXHRcdEBtaXQtbGljZW5zZVxuXG5cdFx0Q29weXJpZ2h0IChAYykgMjAxNyBSaWNoZXZlIFNpb2RpbmEgQmViZWRvclxuXHRcdEBlbWFpbDogcmljaGV2ZS5iZWJlZG9yQGdtYWlsLmNvbVxuXG5cdFx0UGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuXHRcdG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcblx0XHRpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG5cdFx0dG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuXHRcdGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuXHRcdGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblx0XHRUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcblx0XHRjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5cdFx0VEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuXHRcdElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuXHRcdEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuXHRcdEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcblx0XHRMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuXHRcdE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5cdFx0U09GVFdBUkUuXG5cdEBlbmQtbW9kdWxlLWxpY2Vuc2VcblxuXHRAbW9kdWxlLWNvbmZpZ3VyYXRpb246XG5cdFx0e1xuXHRcdFx0XCJwYWNrYWdlXCI6IFwiZXRoZXJuaXR5XCIsXG5cdFx0XHRcInBhdGhcIjogXCJldGhlcm5pdHkvZXRoZXJuaXR5LmpzXCIsXG5cdFx0XHRcImZpbGVcIjogXCJldGhlcm5pdHkuanNcIixcblx0XHRcdFwibW9kdWxlXCI6IFwiZXRoZXJuaXR5XCIsXG5cdFx0XHRcImF1dGhvclwiOiBcIlJpY2hldmUgUy4gQmViZWRvclwiLFxuXHRcdFx0XCJjb250cmlidXRvcnNcIjogW1xuXHRcdFx0XHRcIkpvaG4gTGVub24gTWFnaGFub3kgPGpvaG5sZW5vbm1hZ2hhbm95QGdtYWlsLmNvbT5cIlxuXHRcdFx0XSxcblx0XHRcdFwiZU1haWxcIjogXCJyaWNoZXZlLmJlYmVkb3JAZ21haWwuY29tXCIsXG5cdFx0XHRcInJlcG9zaXRvcnlcIjogXCJodHRwczovL2dpdGh1Yi5jb206dm9sa292YXN5c3RlbXMvZXRoZXJuaXR5LmdpdFwiLFxuXHRcdFx0XCJ0ZXN0XCI6IFwiZXRoZXJuaXR5LXRlc3QuanNcIixcblx0XHRcdFwiZ2xvYmFsXCI6IHRydWUsXG5cdFx0XHRcImNsYXNzXCI6IHRydWUsXG5cdFx0fVxuXHRAZW5kLW1vZHVsZS1jb25maWd1cmF0aW9uXG5cblx0QG1vZHVsZS1kb2N1bWVudGF0aW9uOlxuXHRcdFBlcnNpc3QgdGltZSBhcyB0cnVlIHRpbWUuXG5cblx0XHRUaGlzIHdpbGwgZGlzY2FyZCBtaWxsaXNlY29uZHMgdmFsdWUuXG5cdEBlbmQtbW9kdWxlLWRvY3VtZW50YXRpb25cblxuXHRAaW5jbHVkZTpcblx0XHR7XG5cdFx0XHRcImNsYXpvZlwiOiBcImNsYXpvZlwiLFxuXHRcdFx0XCJkZXBoZXJcIjogXCJkZXBoZXJcIixcblx0XHRcdFwiZGlhdG9tXCI6IFwiZGlhdG9tXCIsXG5cdFx0XHRcImRvdWJ0XCI6IFwiZG91YnRcIixcblx0XHRcdFwiZmFsemVcIjogXCJmYWx6ZVwiLFxuXHRcdFx0XCJmYWx6eVwiOiBcImZhbHp5XCIsXG5cdFx0XHRcImhhcmRlblwiOiBcImhhcmRlblwiLFxuXHRcdFx0XCJtb21lbnRcIjogXCJtb21lbnRcIixcblx0XHRcdFwib3B0Zm9yXCI6IFwib3B0Zm9yXCIsXG5cdFx0XHRcInJhemVcIjogXCJyYXplXCIsXG5cdFx0XHRcInRydWx5XCI6IFwidHJ1bHlcIixcblx0XHRcdFwiVTIwMGJcIjogXCJ1MjAwYlwiXG5cdFx0fVxuXHRAZW5kLWluY2x1ZGVcbiovXG5cbmNvbnN0IGNsYXpvZiA9IHJlcXVpcmUoIFwiY2xhem9mXCIgKTtcbmNvbnN0IGRlcGhlciA9IHJlcXVpcmUoIFwiZGVwaGVyXCIgKTtcbmNvbnN0IGRpYXRvbSA9IHJlcXVpcmUoIFwiZGlhdG9tXCIgKTtcbmNvbnN0IGRvdWJ0ID0gcmVxdWlyZSggXCJkb3VidFwiICk7XG5jb25zdCBmYWx6ZSA9IHJlcXVpcmUoIFwiZmFsemVcIiApO1xuY29uc3QgZmFsenkgPSByZXF1aXJlKCBcImZhbHp5XCIgKTtcbmNvbnN0IGhhcmRlbiA9IHJlcXVpcmUoIFwiaGFyZGVuXCIgKTtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoIFwibW9tZW50XCIgKTtcbmNvbnN0IG9wdGZvciA9IHJlcXVpcmUoIFwib3B0Zm9yXCIgKTtcbmNvbnN0IHByb3R5cGUgPSByZXF1aXJlKCBcInByb3R5cGVcIiApO1xuY29uc3QgcmF6ZSA9IHJlcXVpcmUoIFwicmF6ZVwiICk7XG5jb25zdCB0cnVseSA9IHJlcXVpcmUoIFwidHJ1bHlcIiApO1xuY29uc3QgVTIwMGIgPSByZXF1aXJlKCBcInUyMDBiXCIgKTtcblxuY29uc3QgQ09NUEFDVF9GT1JNQVQgPSBcIllZWVlNTURESEhtbXNzXCI7XG5jb25zdCBERUZBVUxUX1NFUEFSQVRPUiA9IFwiIHwgXCI7XG5jb25zdCBJU084NjAxX0ZPUk1BVCA9IFwiWVlZWS1NTS1ERFRISDptbTpzc1wiO1xuY29uc3QgTlVNRVJJQ19QQVRURVJOID0gL1xcZCsvO1xuY29uc3QgU0lNUExFX0RBVEVfRk9STUFUID0gXCJNTU1NIERELCBZWVlZXCI7XG5jb25zdCBTSU1QTEVfVElNRV9GT1JNQVQgPSBcImhoOm1tOnNzIEFcIjtcbmNvbnN0IFRSVUVfVElNRV9QQVRURVJOID0gL15cXC1bXFxkXFx1MjAwYl17MjZ9fF5bXFxkXFx1MjAwYl17Mjd9JC87XG5cbmNvbnN0IEV0aGVybml0eSA9IGRpYXRvbSggXCJFdGhlcm5pdHlcIiApO1xuXG5oYXJkZW4oIFwibm93XCIsIGZ1bmN0aW9uIG5vdyggKXtcblx0cmV0dXJuIEV0aGVybml0eSggKS5jb21wYWN0KCApO1xufSwgRXRoZXJuaXR5ICk7XG5cbkV0aGVybml0eS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZyggKXtcblx0cmV0dXJuIHRoaXMudHJ1ZVRpbWU7XG59O1xuXG5FdGhlcm5pdHkucHJvdG90eXBlLnZhbHVlT2YgPSBmdW5jdGlvbiB2YWx1ZU9mKCApe1xuXHRyZXR1cm4gdGhpcy50cnVlVGltZTtcbn07XG5cbkV0aGVybml0eS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIGluaXRpYWxpemUoIGRhdGUgKXtcblx0Lyo7XG5cdFx0QG1ldGEtY29uZmlndXJhdGlvbjpcblx0XHRcdHtcblx0XHRcdFx0XCJkYXRlOnJlcXVpcmVkXCI6IFtcblx0XHRcdFx0XHRbIFwibnVtYmVyXCIsIFwibnVtYmVyXCIgXSxcblx0XHRcdFx0XHRcInN0cmluZ1wiLFxuXHRcdFx0XHRcdERhdGVcblx0XHRcdFx0XVxuXHRcdFx0fVxuXHRcdEBlbmQtbWV0YS1jb25maWd1cmF0aW9uXG5cdCovXG5cblx0aWYoIGRvdWJ0KCBkYXRlLCBBUlJBWSApICYmXG5cdFx0cHJvdHlwZSggZGF0ZVsgMCBdLCBOVU1CRVIgKSAmJlxuXHRcdHByb3R5cGUoIGRhdGVbIDEgXSwgTlVNQkVSICkgJiZcblx0XHRkYXRlWyAwIF0udG9TdHJpbmcoICkubGVuZ3RoID09IDE3IClcblx0e1xuXHRcdHRoaXMub2Zmc2V0ID0gZGF0ZVsgMSBdO1xuXG5cdFx0dGhpcy5kYXRlID0gbW9tZW50LnV0YyggZGF0ZVsgMCBdLCBDT01QQUNUX0ZPUk1BVCApXG5cdFx0XHQubWlsbGlzZWNvbmQoIDAgKVxuXHRcdFx0LnV0Y09mZnNldCggdGhpcy5vZmZzZXQgKTtcblxuXHRcdHRoaXMucGVyc2lzdCggKTtcblxuXHR9ZWxzZSBpZiggcHJvdHlwZSggZGF0ZSwgU1RSSU5HICkgJiYgZGF0ZS5sZW5ndGggPT0gMjcgJiYgVFJVRV9USU1FX1BBVFRFUk4udGVzdCggZGF0ZSApICl7XG5cdFx0dGhpcy5kYXRlID0gZGF0ZTtcblxuXHRcdHRoaXMucGFyc2UoICk7XG5cblx0fWVsc2UgaWYoIHRydWx5KCBkYXRlICkgJiYgcHJvdHlwZSggZGF0ZSwgU1RSSU5HICkgKXtcblx0XHR0cnl7XG5cdFx0XHRkYXRlID0gbW9tZW50KCBkYXRlICk7XG5cblx0XHRcdGlmKCBkYXRlLmlzVmFsaWQoICkgKXtcblx0XHRcdFx0dGhpcy5pbml0aWFsaXplKCBkYXRlLnRvRGF0ZSggKSApO1xuXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCBgaW52YWxpZCBkYXRlIGZvcm1hdCwgJHsgYXJndW1lbnRzWyAwIF0gfWAgKTtcblx0XHRcdH1cblxuXHRcdH1jYXRjaCggZXJyb3IgKXtcblx0XHRcdHRocm93IG5ldyBFcnJvciggYGVycm9yIGVuY291bnRlcmVkIHdoaWxlIHBhcnNpbmcgZGF0ZSwgJHsgZXJyb3IgfWAgKTtcblx0XHR9XG5cblx0fWVsc2UgaWYoIGNsYXpvZiggZGF0ZSwgRGF0ZSApICl7XG5cdFx0dGhpcy5kYXRlID0gbW9tZW50KCBkYXRlICk7XG5cblx0XHR0aGlzLnBlcnNpc3QoICk7XG5cblx0fWVsc2V7XG5cdFx0dGhpcy5kYXRlID0gbW9tZW50KCBuZXcgRGF0ZSggKSApO1xuXG5cdFx0dGhpcy5wZXJzaXN0KCApO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59O1xuXG4vKlxuXHRAbWV0aG9kLWRvY3VtZW50YXRpb246XG5cdFx0VGhpcyBzaG91bGQgYmUgcGVyc2lzdGVkIG9uIHRoZSBtYWNoaW5lIHdoZXJlIHRoZSB0aW1lem9uZSBpcyBwZXJzaXN0ZWQuXG5cblx0XHRJdCB3aWxsIHNhdmUgdGhlIHRydWUgdGltZSBpbiB1dGMgZm9ybWF0ICsgdGhlIG1hY2hpbmUgdGltZXpvbmUuXG5cdEBlbmQtbWV0aG9kLWRvY3VtZW50YXRpb25cbiovXG5FdGhlcm5pdHkucHJvdG90eXBlLnBlcnNpc3QgPSBmdW5jdGlvbiBwZXJzaXN0KCApe1xuXHRpZiggdHJ1bHkoIHRoaXMudHJ1ZVRpbWUgKSApe1xuXHRcdHJldHVybiB0aGlzLnRydWVUaW1lO1xuXHR9XG5cblx0bGV0IGRhdGUgPSB0aGlzLmRhdGUudG9EYXRlKCApO1xuXG5cdGxldCBvZmZzZXQgPSB0aGlzLm9mZnNldCB8fCB0aGlzLmRhdGUudXRjT2Zmc2V0KCApO1xuXHR0cnl7XG5cdFx0b2Zmc2V0ID0gcGFyc2VJbnQoIG9mZnNldCApO1xuXG5cdH1jYXRjaCggZXJyb3IgKXtcblx0XHR0aHJvdyBuZXcgRXJyb3IoIGBpbnZhbGlkIHRpbWV6b25lIG9mZnNldCwgJHsgZXJyb3IgfWAgKTtcblx0fVxuXG5cdGxldCBwb2xhcml0eSA9IDA7XG5cdGlmKCBvZmZzZXQgIT0gMCApe1xuXHRcdHBvbGFyaXR5ID0gb2Zmc2V0IC8gTWF0aC5hYnMoIG9mZnNldCApO1xuXHR9XG5cblx0bGV0IHRydWVUaW1lID0gVTIwMGIoIFtcblx0XHQvLzogcG9zaXRpdmUgLyBuZWdhdGl2ZSBvZmZzZXRcblx0XHRwb2xhcml0eS50b1N0cmluZyggKS5yZXBsYWNlKCBOVU1FUklDX1BBVFRFUk4sIFwiXCIgKSB8fCBcIjBcIixcblxuXHRcdC8vOiB5ZWFyXG5cdFx0ZGF0ZS5nZXRVVENGdWxsWWVhciggKSxcblxuXHRcdC8vOiBtb250aFxuXHRcdCggXCIwXCIgKyAoIGRhdGUuZ2V0VVRDTW9udGgoICkgKyAxICkgKS5zbGljZSggLTIgKSxcblxuXHRcdC8vOiBkYXlcblx0XHQoIFwiMFwiICsgKCBkYXRlLmdldFVUQ0RhdGUoICkgKSApLnNsaWNlKCAtMiApLFxuXG5cdFx0Ly86IGhvdXJcblx0XHQoIFwiMFwiICsgKCBkYXRlLmdldFVUQ0hvdXJzKCApICkgKS5zbGljZSggLTIgKSxcblxuXHRcdC8vOiBtaW51dGVcblx0XHQoIFwiMFwiICsgKCBkYXRlLmdldFVUQ01pbnV0ZXMoICkgKSApLnNsaWNlKCAtMiApLFxuXG5cdFx0Ly86IHNlY29uZFxuXHRcdCggXCIwXCIgKyAoIGRhdGUuZ2V0VVRDU2Vjb25kcyggKSApICkuc2xpY2UoIC0yICksXG5cblx0XHQvLzogb2Zmc2V0XG5cdFx0KCBcIjAwMFwiICsgTWF0aC5hYnMoIG9mZnNldCApICkuc2xpY2UoIC01IClcblx0XSApLmpvaW4oICk7XG5cblx0dGhpcy50cnVlVGltZSA9IHRydWVUaW1lO1xuXG5cdHRoaXMub2Zmc2V0ID0gb2Zmc2V0O1xuXG5cdHJldHVybiB0cnVlVGltZTtcbn07XG5cbi8qO1xuXHRAbWV0aG9kLWRvY3VtZW50YXRpb246XG5cdFx0RGVjb21wb3NlIHRydWUgdGltZSB0byBhIG1vbWVudCBvYmplY3QuXG5cdEBlbmQtbWV0aG9kLWRvY3VtZW50YXRpb25cbiovXG5FdGhlcm5pdHkucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gcGFyc2UoICl7XG5cdGxldCBkYXRlID0gdGhpcy5kYXRlO1xuXG5cdGlmKCBwcm90eXBlKCB0aGlzLmRhdGUsIFNUUklORyApICl7XG5cdFx0ZGF0ZSA9IFUyMDBiKCB0aGlzLmRhdGUgKS5zZXBhcmF0ZSggKTtcblxuXHR9ZWxzZSBpZiggdHJ1bHkoIHRoaXMudHJ1ZVRpbWUgKSApe1xuXHRcdGRhdGUgPSBVMjAwYiggdGhpcy50cnVlVGltZSApLnNlcGFyYXRlKCApO1xuXG5cdH1lbHNle1xuXHRcdHRocm93IG5ldyBFcnJvciggXCJkYXRlIG5vdCBzcGVjaWZpZWRcIiApO1xuXHR9XG5cblx0dHJ5e1xuXHRcdGxldCBwb2xhcml0eSA9IHBhcnNlSW50KCBkYXRlWyAwIF0gKyAxICk7XG5cblx0XHR0aGlzLm9mZnNldCA9IHBvbGFyaXR5ICogcGFyc2VJbnQoIGRhdGVbIDcgXSApO1xuXG5cdFx0ZGF0ZSA9IG1vbWVudC51dGMoIClcblx0XHRcdC55ZWFyKCBwYXJzZUludCggZGF0ZVsgMSBdICkgKVxuXHRcdFx0Lm1vbnRoKCBwYXJzZUludCggZGF0ZVsgMiBdICkgLSAxIClcblx0XHRcdC5kYXRlKCBwYXJzZUludCggZGF0ZVsgMyBdICkgKVxuXHRcdFx0LmhvdXIoIHBhcnNlSW50KCBkYXRlWyA0IF0gKSApXG5cdFx0XHQubWludXRlKCBwYXJzZUludCggZGF0ZVsgNSBdICkgKVxuXHRcdFx0LnNlY29uZCggcGFyc2VJbnQoIGRhdGVbIDYgXSApIClcblx0XHRcdC5taWxsaXNlY29uZCggMCApO1xuXG5cdH1jYXRjaCggZXJyb3IgKXtcblx0XHR0aHJvdyBuZXcgRXJyb3IoIGBlcnJvciBwYXJzaW5nIHRydWUgdGltZSwgJHsgZXJyb3IgfWAgKTtcblx0fVxuXG5cdC8vOiBUaGlzIHdpbGwgc2V0IHRoZSB0aW1lem9uZSBvZiB0aGUgRGF0ZSBvYmplY3QgdG8gdGhlIG1hY2hpbmUgdGltZXpvbmUuXG5cdHRoaXMuZGF0ZSA9IGRhdGU7XG5cblx0dGhpcy5wZXJzaXN0KCApO1xuXG5cdHJldHVybiB0aGlzO1xufTtcblxuLyo7XG5cdEBtZXRob2QtZG9jdW1lbnRhdGlvbjpcblx0XHRSZWxhdGl2ZSB0aW1lIGlzIHRoZSB0aW1lIGFwcGxpZWQgd2l0aCBVVEMgb2Zmc2V0LlxuXG5cdFx0VGhpcyB3aWxsIHJldHVybiB0aGUgdGltZSBpbiBJU084NjAxIGZvcm1hdCBmb3JtYXQgd2l0aCBtaWxsaXNlY29uZHMgZHJvcHBlZC5cblx0XHRcdEBjb2RlOllZWVktTU0tRERUSEg6bW0uc3M7XG5cblx0XHREbyBub3QgdXNlIHRoaXMgdG8gcmVmZXJlbmNlIHRydWUgdGltZS5cblx0QGVuZC1tZXRob2QtZG9jdW1lbnRhdGlvblxuKi9cbkV0aGVybml0eS5wcm90b3R5cGUucmVsYXRpdmVUaW1lID0gZnVuY3Rpb24gcmVsYXRpdmVUaW1lKCApe1xuXHRpZiggZmFsemUoIHRoaXMuZGF0ZSApICl7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCBcImludGVybmFsIGRhdGUgZW1wdHlcIiApO1xuXHR9XG5cblx0aWYoIGZhbHp5KCB0aGlzLm9mZnNldCApICl7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCBcImludGVybmFsIHRpbWV6b25lIG9mZnNldCBlbXB0eVwiICk7XG5cdH1cblxuXHRyZXR1cm4gdGhpcy5kYXRlLnV0YyggKS51dGNPZmZzZXQoIHRoaXMub2Zmc2V0ICkuZm9ybWF0KCBJU084NjAxX0ZPUk1BVCApO1xufTtcblxuLyo7XG5cdEBtZXRob2QtZG9jdW1lbnRhdGlvbjpcblx0XHRSZWFsIHRpbWUgaXMgdGhlIHRpbWUgd2l0aCBubyBVVEMgb2Zmc2V0IGFwcGxpZWQuXG5cblx0XHRUaGlzIHdpbGwgcmV0dXJuIHRoZSB0aW1lIGluIElTTzg2MDEgZm9ybWF0IHdpdGggbWlsbGlzZWNvbmRzIGRyb3BwZWQuXG5cblx0XHRgWVlZWS1NTS1ERFRISDptbS5zc2Bcblx0QGVuZC1tZXRob2QtZG9jdW1lbnRhdGlvblxuKi9cbkV0aGVybml0eS5wcm90b3R5cGUucmVhbFRpbWUgPSBmdW5jdGlvbiByZWFsVGltZSggKXtcblx0aWYoIGZhbHplKCB0aGlzLmRhdGUgKSApe1xuXHRcdHRocm93IG5ldyBFcnJvciggXCJpbnRlcm5hbCBkYXRlIGVtcHR5XCIgKTtcblx0fVxuXG5cdHJldHVybiB0aGlzLmRhdGUudXRjKCApLmZvcm1hdCggSVNPODYwMV9GT1JNQVQgKTtcbn07XG5cbi8qO1xuXHRAbWV0aG9kLWRvY3VtZW50YXRpb246XG5cdFx0UmV0dXJucyBhIHNpbXBsZSBodW1hbiByZWFkYWJsZSByZXByZXNlbnRhdGlvbiBvZiB0aW1lIGluIDEyIGhvdXIgZm9ybWF0LlxuXG5cdFx0VGltZSB3aWxsIGJlIHJlbGF0aXZlLlxuXHRAZW5kLW1ldGhvZC1kb2N1bWVudGF0aW9uXG4qL1xuRXRoZXJuaXR5LnByb3RvdHlwZS5nZXRUaW1lID0gZnVuY3Rpb24gZ2V0VGltZSggKXtcblx0aWYoIGZhbHplKCB0aGlzLmRhdGUgKSApe1xuXHRcdHRocm93IG5ldyBFcnJvciggXCJpbnRlcm5hbCBkYXRlIGVtcHR5XCIgKTtcblx0fVxuXG5cdGlmKCBmYWx6eSggdGhpcy5vZmZzZXQgKSApe1xuXHRcdHRocm93IG5ldyBFcnJvciggXCJpbnRlcm5hbCB0aW1lem9uZSBvZmZzZXQgZW1wdHlcIiApO1xuXHR9XG5cblx0cmV0dXJuIHRoaXMuZGF0ZS51dGMoICkudXRjT2Zmc2V0KCB0aGlzLm9mZnNldCApLmZvcm1hdCggU0lNUExFX1RJTUVfRk9STUFUICk7XG59O1xuXG4vKjtcblx0QG1ldGhvZC1kb2N1bWVudGF0aW9uOlxuXHRcdFJldHVybnMgYSBzaW1wbGUgaHVtYW4gcmVhZGFibGUgcmVwcmVzZW50YXRpb24gb2YgZGF0ZS5cblxuXHRcdERhdGUgd2lsbCBiZSByZWxhdGl2ZS5cblx0QGVuZC1tZXRob2QtZG9jdW1lbnRhdGlvblxuKi9cbkV0aGVybml0eS5wcm90b3R5cGUuZ2V0RGF0ZSA9IGZ1bmN0aW9uIGdldERhdGUoICl7XG5cdGlmKCBmYWx6eSggdGhpcy5kYXRlICkgKXtcblx0XHR0aHJvdyBuZXcgRXJyb3IoIFwiaW50ZXJuYWwgZGF0ZSBlbXB0eVwiICk7XG5cdH1cblxuXHRpZiggZmFsenkoIHRoaXMub2Zmc2V0ICkgKXtcblx0XHR0aHJvdyBuZXcgRXJyb3IoIFwiaW50ZXJuYWwgdGltZXpvbmUgb2Zmc2V0IGVtcHR5XCIgKTtcblx0fVxuXG5cdHJldHVybiB0aGlzLmRhdGUudXRjKCApLnV0Y09mZnNldCggdGhpcy5vZmZzZXQgKS5mb3JtYXQoIFNJTVBMRV9EQVRFX0ZPUk1BVCApO1xufTtcblxuLyo7XG5cdEBtZXRob2QtZG9jdW1lbnRhdGlvbjpcblx0XHRSZXR1cm5zIGEgc2ltcGxlIGh1bWFuIHJlYWRhYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRpbWUgYW5kIGRhdGUuXG5cblx0XHRUaW1lIGFuZCBkYXRlIHdpbGwgYmUgcmVsYXRpdmUuXG5cblx0XHRTZXR0aW5nIGNvbXBsZXRlIHdpbGwgYXBwZW5kIHRydWUgdGltZSBmb3JtYXQuXG5cdEBlbmQtbWV0aG9kLWRvY3VtZW50YXRpb25cbiovXG5FdGhlcm5pdHkucHJvdG90eXBlLnByaW50VGltZSA9IGZ1bmN0aW9uIHByaW50VGltZSggc2VwYXJhdG9yLCBjb21wbGV0ZSApe1xuXHQvKjtcblx0XHRAbWV0YS1jb25maWd1cmF0aW9uOlxuXHRcdFx0e1xuXHRcdFx0XHRcInNlcGFyYXRvclwiOiBcInN0cmluZ1wiLFxuXHRcdFx0XHRcImNvbXBsZXRlXCI6IFwiYm9vbGVhblwiXG5cdFx0XHR9XG5cdFx0QGVuZC1tZXRhLWNvbmZpZ3VyYXRpb25cblx0Ki9cblxuXHRsZXQgcGFyYW1ldGVyID0gcmF6ZSggYXJndW1lbnRzICk7XG5cblx0c2VwYXJhdG9yID0gb3B0Zm9yKCBwYXJhbWV0ZXIsIFNUUklORyApO1xuXG5cdHNlcGFyYXRvciA9IHNlcGFyYXRvciB8fCBERUZBVUxUX1NFUEFSQVRPUjtcblx0aWYoICFwcm90eXBlKCBzZXBhcmF0b3IsIFNUUklORyApICl7XG5cdFx0c2VwYXJhdG9yID0gREVGQVVMVF9TRVBBUkFUT1I7XG5cdH1cblxuXHRjb21wbGV0ZSA9IGRlcGhlciggYXJndW1lbnRzLCBCT09MRUFOLCBmYWxzZSApO1xuXG5cdGlmKCBjb21wbGV0ZSA9PT0gdHJ1ZSApe1xuXHRcdHJldHVybiBbIHRoaXMuZ2V0RGF0ZSggKSwgdGhpcy5nZXRUaW1lKCApLCB0aGlzLnRydWVUaW1lIF0uam9pbiggc2VwYXJhdG9yICk7XG5cblx0fWVsc2V7XG5cdFx0cmV0dXJuIFsgdGhpcy5nZXREYXRlKCApLCB0aGlzLmdldFRpbWUoICkgXS5qb2luKCBzZXBhcmF0b3IgKTtcblx0fVxufTtcblxuLyo7XG5cdEBtZXRob2QtZG9jdW1lbnRhdGlvbjpcblx0XHRSZXR1cm5zIGEgbnVtZXJpY2FsIHJlcHJlc2VudGF0aW9uIG9mIHRydWUgdGltZS5cblx0QGVuZC1tZXRob2QtZG9jdW1lbnRhdGlvblxuKi9cbkV0aGVybml0eS5wcm90b3R5cGUuY29tcGFjdCA9IGZ1bmN0aW9uIGNvbXBhY3QoICl7XG5cdHJldHVybiBbIHRoaXMuZGF0ZS51dGMoICkuZm9ybWF0KCBDT01QQUNUX0ZPUk1BVCApLCB0aGlzLm9mZnNldCBdXG5cdFx0Lm1hcCggZnVuY3Rpb24gb25FYWNoVG9rZW4oIHRva2VuICl7IHJldHVybiBwYXJzZUludCggdG9rZW4udG9TdHJpbmcoICkgKTsgfSApO1xufTtcblxuXG5cbm1vZHVsZS5leHBvcnRzID0gRXRoZXJuaXR5O1xuIl19
